# Documentation Audit — 2026-02-23

**Scope:** Active documentation in `docs/` (non-archive)
**Framework:** Diátaxis (4-quadrant: tutorial, how-to, reference, explanation)
**Method:** Cross-check every documented claim against source code in `packages/`

---

## 1. Executive Summary

The documentation structure is correctly organized around the Diátaxis framework with
four clearly labeled directories. Overall quality is high, but **1 critical bug** and
**2 major inaccuracies** were found that would mislead or break code written against
the docs. Additionally, several coverage gaps and structural issues reduce the usefulness
of the documentation.

| Severity | Count |
|----------|-------|
| CRITICAL | 1 |
| MAJOR | 2 |
| MINOR | 4 |
| DIÁTAXIS CONFORMANCE | 3 |

---

## 2. Findings

### CRITICAL

---

#### CRIT-01: `SettingsRegistryError.reason` property does not exist

**File:** `docs/reference/exceptions.md`
**Lines:** 246–265

The documentation claims `SettingsRegistryError` has a `reason` property:

```
| Property  | Type  | Description                                |
|-----------|-------|--------------------------------------------|
| namespace | str   | The namespace involved                     |
| reason    | str   | Detail (e.g., "Namespace already registered") |
```

And includes a working code example:

```python
except SettingsRegistryError as e:
    print(e.namespace)  # "core"
    print(e.reason)     # "Namespace already registered"
```

**Reality (source `packages/settings/src/color_scheme_settings/errors.py:58–64`):**

```python
class SettingsRegistryError(SettingsError):
    def __init__(self, namespace: str, reason: str = "") -> None:
        self.namespace = namespace          # stored ✓
        detail = f": {reason}" if reason else ""
        super().__init__(f"Registry error for namespace '{namespace}'{detail}")
        # self.reason is NEVER stored
```

Accessing `e.reason` on a `SettingsRegistryError` instance raises `AttributeError`.

**Impact:** Any code written against this documentation will crash at runtime.

**Fix required:** Either store `self.reason = reason` in the exception class, or remove
the `reason` row from the properties table and remove `e.reason` from the example.

---

### MAJOR

---

#### MAJ-01: Saturation factor not always present in `show` info panel

**Files:**
- `docs/tutorials/getting-started.md`, line 42–45
- `docs/reference/cli-core.md`, lines 185–186

Both documents state:

> "An information panel listing the source image, backend used, and saturation factor."

**Reality (source `packages/core/src/color_scheme/cli/main.py:420–425`):**

```python
if (
    generator_config.saturation_adjustment is not None
    and generator_config.saturation_adjustment != 1.0
):
    info_lines.append(
        f"[cyan]Saturation:[/cyan] {generator_config.saturation_adjustment}"
    )
```

The saturation factor is only added to the info panel when the value is not `1.0`. At
the default setting (1.0), the info panel shows only source image and backend — no
saturation line.

**Impact:** Users testing with the default saturation will not see the saturation row
and may believe the tool is not reading their config correctly.

**Fix required:** Update both files to say saturation is shown "when non-default" or
"when not 1.0".

---

#### MAJ-02: ENV layer missing from priority table in configure-settings

**File:** `docs/how-to/configure-settings.md`, lines 13–21

The priority table presents four layers:

| Priority | Layer         |
|----------|---------------|
| 1 (lowest) | Package defaults |
| 2          | Project config  |
| 3          | User config     |
| 4 (highest) | CLI overrides  |

The `COLORSCHEME_*` environment variables are then explained in a separate prose
section (line 49) as having higher priority than user config, implying a fifth layer.

**Reality (`docs/reference/settings-api.md` layer diagram):**

```
package defaults
    ↑ overridden by project settings.toml
    ↑ overridden by user ~/.config/...
    ↑ overridden by COLORSCHEME_* environment variables
    ↑ overridden by get_config(overrides) / CLI
```

There are **5 layers**. The table in `configure-settings.md` omits environment
variables as a numbered priority row, which contradicts the reference doc that
explicitly places ENV between user config and CLI.

**Impact:** A user reading only the how-to guide will not know that environment
variables override their user config file, which is a significant operational gap.

**Fix required:** Expand the table to 5 rows:

| Priority | Layer |
|----------|-------|
| 3.5 (or rename to 4) | COLORSCHEME_* env vars |

---

### MINOR

---

#### MIN-01: `reset()` function not documented in Settings API reference

**File:** `docs/reference/settings-api.md`

The `reset()` function is listed in `packages/settings/src/color_scheme_settings/__init__.py`:

```python
def reset() -> None:
    """Reset the entire settings system. For testing only."""
    global _config, _unified_model, _loader_kwargs
    _config = None
    _unified_model = None
    _loader_kwargs = {}
    SchemaRegistry.clear()
```

It is also in `__all__` (line 121). It resets more than `reload_config()` does — it
clears `_unified_model` and `_loader_kwargs` as well, requiring `configure()` to be
called again. This distinction matters for test setup.

**Fix required:** Add a `reset()` section to `settings-api.md` documenting its
behavior and intended use (testing only).

---

#### MIN-02: `TemplateRegistryError` hierarchy and related exceptions incomplete

**File:** `docs/reference/exceptions.md`, lines 270–279

The `TemplateRegistryError` entry:
- Lists the module as "(color-scheme-templates package)" — vague; should be
  `color_scheme_templates.errors`
- Does not document the parent class (`TemplateError`) or sibling exception
  `TemplateNotFoundError`
- The `reason` property IS stored in this class (`self.reason = reason` in
  `packages/templates/src/color_scheme_templates/errors.py:30`) and SHOULD be
  documented (compare with CRIT-01 where `SettingsRegistryError.reason` is wrongly
  claimed to exist)
- The exception hierarchy diagram does not include `TemplateError` or
  `TemplateNotFoundError`

**Fix required:**
1. Set module to `color_scheme_templates.errors`
2. Add `TemplateError` and `TemplateNotFoundError` to the hierarchy and give them
   entries
3. Add `reason` to `TemplateRegistryError` properties table (it actually exists here)

---

#### MIN-03: `color-scheme version` output format not shown

**File:** `docs/reference/cli-orchestrator.md`, lines 25–33

The `color-scheme version` section has no example output. The core reference
(`cli-core.md`) shows an example:

```bash
$ color-scheme-core version
color-scheme-core version 0.1.0
```

The orchestrator outputs `color-scheme-orchestrator version {__version__}` (source
`packages/orchestrator/src/color_scheme_orchestrator/cli/main.py:37`), which is
a different string from the entry point name `color-scheme`. This difference is worth
showing.

**Fix required:** Add an example block matching `cli-core.md` style.

---

#### MIN-04: Brittle internal source file reference in architecture explanation

**File:** `docs/explanation/architecture.md`, line 51

> "This order is enforced in code (`factory.py`) and confirmed by tests"

Referencing `factory.py` by filename couples the explanation doc to the internal
source layout. If the file is renamed or the logic moved, this line becomes misleading.
Explanation documents should not cite internal implementation files.

**Fix required:** Remove the filename reference. The fact is stable; the path is not.

---

## 3. Diátaxis Conformance Issues

---

#### DX-01: No navigation index at `docs/`

Diátaxis requires a clear entry point that orients readers toward the four quadrants.
There is no `docs/README.md` or `docs/index.md`. A user who opens the `docs/` directory
sees four directories (`explanation/`, `how-to/`, `reference/`, `tutorials/`) with no
guidance on which to read first or when each type is appropriate.

**Fix required:** Add `docs/README.md` that:
1. Briefly describes the project
2. Explains the Diátaxis layout (4 doc types, when to use each)
3. Provides a quick start path pointing to `tutorials/getting-started.md`

---

#### DX-02: No cross-links between documents

None of the active documents link to related documents in other sections. Diátaxis
navigation works through deliberate cross-referencing:

| Document | Should link to |
|----------|----------------|
| `tutorials/getting-started.md` | `explanation/architecture.md` (for deeper understanding), `reference/cli-core.md` (for all options) |
| `how-to/configure-settings.md` | `reference/settings-api.md` (for API details), `explanation/architecture.md` (settings layers mental model) |
| `how-to/install-backends.md` | `explanation/architecture.md` (container model) |
| `reference/cli-core.md` | `how-to/use-dry-run.md`, `how-to/configure-settings.md` |

Without these links, users must discover related content themselves.

**Fix required:** Add "See also" sections or inline links at the bottom of each doc.

---

#### DX-03: Coverage gaps — missing how-to guides

The current 3 how-to guides cover: configure settings, install backends, use dry-run.
The following task-oriented documentation is absent (all existed in `docs/archive/`):

| Missing how-to | User need |
|----------------|-----------|
| Troubleshoot common errors | Error messages are documented in reference but no remediation steps exist |
| Integrate with shell (source the `.sh` output) | The output formats are documented but not how to use them in practice |
| Create custom templates | The template system is referenced but never explained operationally |

**Fix required:** Restore or create the three how-to guides listed above. Their archived
versions exist in `docs/archive/how-to/` as a starting point.

---

## 4. Accuracy Confirmation (Passed)

The following documentation claims were verified correct against source code:

| Claim | Source file | Result |
|-------|-------------|--------|
| Backend auto-detection order: wallust → pywal → custom | `factory.py:130` | PASS |
| ColorScheme requires exactly 16 colors | `types.py:100` | PASS |
| `color_count` hardcoded to 16 | `types.py:125` | PASS |
| `load_config()` caches result | `__init__.py:63–64` | PASS |
| `reload_config()` clears cache | `__init__.py:77–81` | PASS |
| Engine validation: only `docker`/`podman` accepted | `install.py:96–101` | PASS |
| Default engine is `docker` | `install.py:93` | PASS |
| Build command: `<engine> build -f <dockerfile> -t <image> <context>` | `install.py:147–155` | PASS |
| `uninstall --dry-run` skips confirmation prompt | `uninstall.py:55–84` | PASS |
| `show` delegates to `color-scheme-core` via subprocess | `orchestrator/cli/main.py:277` | PASS |
| `SettingsRegistryError` raised on duplicate registration | `registry.py:47` | PASS |
| `SchemaRegistry` class methods match documented signatures | `registry.py` | PASS |
| `ColorFormat` enum: 8 values match documented list | `enums.py:21–30` | PASS |
| `Color` hex-RGB consistency message: `"RGB .* does not match hex"` | `types.py:41` | PASS |
| `TemplateRegistryError` message contains "already registered" | `registry.py (templates):26–27` | PASS |
| Image name format: `color-scheme-<backend>:latest` | `install.py:134` | PASS |
| Registry trailing slash stripped | `container/manager.py` (not checked, stated in BHV-0036) | ASSUMED |
| `configure()` signature: `(unified_model, project_root, user_config_path)` | `__init__.py:33` | PASS |
| `get_config()` applies overrides using `apply_overrides` | `__init__.py:97–98` | PASS |

---

## 5. Issues Table

| ID | Severity | File | Description |
|----|----------|------|-------------|
| CRIT-01 | CRITICAL | `reference/exceptions.md` | `SettingsRegistryError.reason` property claimed but not stored in code |
| MAJ-01 | MAJOR | `tutorials/getting-started.md`, `reference/cli-core.md` | Saturation factor shown in info panel only when != 1.0, not always |
| MAJ-02 | MAJOR | `how-to/configure-settings.md` | Priority table has 4 layers; system has 5 (ENV missing) |
| MIN-01 | MINOR | `reference/settings-api.md` | `reset()` function in `__all__` but undocumented |
| MIN-02 | MINOR | `reference/exceptions.md` | `TemplateRegistryError` module path vague; `TemplateError`/`TemplateNotFoundError` absent |
| MIN-03 | MINOR | `reference/cli-orchestrator.md` | No example output for `color-scheme version` |
| MIN-04 | MINOR | `explanation/architecture.md` | Brittle filename reference to `factory.py` |
| DX-01 | DIÁTAXIS | `docs/` root | No navigation index / entry point |
| DX-02 | DIÁTAXIS | All active docs | No cross-links between documents |
| DX-03 | DIÁTAXIS | `how-to/` | Missing: troubleshooting, shell integration, custom templates how-to guides |
